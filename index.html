<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Data Management Tool</title>
  <script src="https://www.gstatic.com/firebasejs/9.0.0/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.0.0/firebase-firestore.js"></script>
  <script>
    // Firebase Config
    const firebaseConfig = {
      apiKey: "AIzaSyArvSLQwgXrK1gjk8g7QSQPCxi4BJ--QlA",
      authDomain: "data-management-tool-c849c.firebaseapp.com",
      projectId: "data-management-tool-c849c",
      storageBucket: "data-management-tool-c849c.firebasestorage.app",
      messagingSenderId: "98848563973",
      appId: "1:98848563973:web:a1e7c051397a303b090d6c",
    };

    // Initialize Firebase
    const app = firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore(app);

    // Function to upload CSV data
    document.getElementById("uploadBtn").addEventListener("click", async () => {
      const fileInput = document.getElementById("csvFileInput");
      const file = fileInput.files[0];
      if (!file) return alert("Please select a CSV file.");

      const reader = new FileReader();
      reader.onload = async function (e) {
        const lines = e.target.result.split("\n");
        const headers = lines[0].split(",").map(h => h.trim().toLowerCase());
        const data = [];
        
        // Parse CSV into JSON
        for (let i = 1; i < lines.length; i++) {
          if (!lines[i].trim()) continue; // Skip empty rows
          const values = lines[i].split(",");
          const row = {};
          headers.forEach((header, index) => {
            row[header] = values[index]?.trim() || "";
          });
          data.push(row);
        }

        // Upload data to Firestore
        try {
          const batch = db.batch(); // Using batch for better performance
          data.forEach(entry => {
            const docRef = db.collection("contacts").doc(); // Create a new document with auto-generated ID
            batch.set(docRef, entry);
          });

          // Commit the batch operation to Firestore
          await batch.commit();
          alert("Data uploaded successfully!");
          loadData(); // Reload the data after successful upload
        } catch (error) {
          console.error("Error uploading data to Firestore:", error);
          alert("Error uploading data. Please check the console for details.");
        }
      };
      reader.readAsText(file);
    });

    // Function to load data from Firestore
    async function loadData() {
      const table = document.getElementById("dataTable");
      table.innerHTML = ""; // Clear the table before reloading
      const snapshot = await db.collection("contacts").get();
      snapshot.forEach(doc => {
        const row = doc.data();
        const tr = document.createElement("tr");
        Object.keys(row).forEach(key => {
          const td = document.createElement("td");
          td.textContent = row[key];
          tr.appendChild(td);
        });
        table.appendChild(tr);
      });
    }

    // Load the data when the page loads
    window.onload = loadData;
  </script>
</head>
<body>
  <h1>CSV Data Upload</h1>
  <input type="file" id="csvFileInput" accept=".csv" />
  <button id="uploadBtn">Upload CSV</button>

  <h2>Data from Firestore</h2>
  <table border="1">
    <thead>
      <tr>
        <th>Name</th>
        <th>Job Title</th>
        <th>Email</th>
        <th>Phone</th>
        <th>LinkedIn</th>
        <th>Company</th>
      </tr>
    </thead>
    <tbody id="dataTable">
      <!-- Data will be populated here -->
    </tbody>
  </table>
</body>
</html>
