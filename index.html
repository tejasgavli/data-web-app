<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Data Upload Tool</title>
  <script type="module">
    // Firebase v9 SDK import
    import { initializeApp } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-app.js";
    import { getFirestore, collection, addDoc, getDocs, query, limit } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore.js";

    // Firebase Config (Updated)
    const firebaseConfig = {
      apiKey: "AIzaSyArvSLQwgXrK1gjk8g7QSQPCxi4BJ--QlA",
      authDomain: "data-management-tool-c849c.firebaseapp.com",
      projectId: "data-management-tool-c849c",
      storageBucket: "data-management-tool-c849c.appspot.com",
      messagingSenderId: "98848563973",
      appId: "1:98848563973:web:a1e7c051397a303b090d6c"
    };

    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);

    document.addEventListener("DOMContentLoaded", () => {
      const fileInput = document.getElementById("csvFile");
      const uploadBtn = document.getElementById("uploadBtn");
      const dataTable = document.getElementById("dataTable");

      uploadBtn.addEventListener("click", async () => {
        const file = fileInput.files[0];
        if (!file) return alert("Please select a CSV file.");

        const reader = new FileReader();
        reader.onload = async function (e) {
          const lines = e.target.result.split("\n");
          const headers = lines[0].split(",").map(h => h.trim());
          const uploadPromises = [];

          for (let i = 1; i < lines.length; i++) {
            const row = lines[i].split(",").map(col => col.trim());
            if (row.length !== headers.length || row.every(col => !col)) continue;

            const data = {};
            headers.forEach((header, index) => {
              data[header] = row[index] || "";
            });

            uploadPromises.push(addDoc(collection(db, "contacts"), data));
          }

          try {
            await Promise.all(uploadPromises);
            alert("Data uploaded successfully");
            loadTable();
          } catch (error) {
            console.error("Error uploading data:", error);
            alert("Upload failed. Check console for errors.");
          }
        };
        reader.readAsText(file);
      });

      async function loadTable() {
        const q = query(collection(db, "contacts"), limit(50));
        const querySnapshot = await getDocs(q);
        dataTable.innerHTML = "";

        querySnapshot.forEach(doc => {
          const row = doc.data();
          const tr = document.createElement("tr");
          tr.innerHTML = `
            <td>${row.name || ""}</td>
            <td>${row.email || ""}</td>
            <td>${row.phone || ""}</td>
            <td>${row.company || ""}</td>
            <td>${row.domain || ""}</td>
          `;
          dataTable.appendChild(tr);
        });
      }

      loadTable();
    });
  </script>
  <style>
    body { font-family: Arial, sans-serif; margin: 40px; }
    table { border-collapse: collapse; width: 100%; margin-top: 20px; }
    th, td { border: 1px solid #ccc; padding: 8px; text-align: left; }
    th { background-color: #f4f4f4; }
  </style>
</head>
<body>
  <h2>CSV Upload to Firestore</h2>
  <input type="file" id="csvFile" accept=".csv" />
  <button id="uploadBtn">Upload CSV</button>

  <h3>Uploaded Data (showing 50 records max)</h3>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Email</th>
        <th>Phone</th>
        <th>Company</th>
        <th>Domain</th>
      </tr>
    </thead>
    <tbody id="dataTable"></tbody>
  </table>
</body>
</html>
